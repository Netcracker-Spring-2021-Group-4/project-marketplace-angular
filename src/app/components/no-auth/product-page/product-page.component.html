<section class="h-100per container d-flex justify-content-sm-between"
         *ngIf="!isLoading">

  <div class="wrapper">
    <div>
      <img mat-card-image src="{{product.imageUrl}}"
           alt="Photo"
           *ngIf="!isLoading || product.imageUrl"
      >
    </div>
    <div>
      <p class="name">{{product.name}}</p>
      <p class="pt-3 pb-3" *ngIf="categoryName$ | async as categoryName">
        {{categoryName | prettyCategory}}
      </p>
      <div *ngIf="discount$ | async as discount">
      <span class="pt-3 pb-3 fw-normal fs-3">Price: </span>
      <span class="fw-bold fs-2" *ngIf="!discount"> {{product.price | customCurrency}}</span>
      <span class="text-secondary text-decoration-line-through"
            *ngIf="discount"> {{product.price | customCurrency}}</span>
      <span class="new-price" *ngIf="discount"> {{discount.offeredPrice | customCurrency}}!</span><br>

      <p class="text-white bg-secondary mt-4 mb-3" *ngIf="discount">
        Hurry up, the discount is valid until
        {{ discount.endsAt | date: 'd, MMMM, y, hh:mm:ss': '+2400'}}
      </p>
      </div>
      <p class="pb-3 pt-3"> {{product.description}} </p>
      <p class="pt-2 pb-4"> Available for purchase:
        <span class="fw-bold">{{product.inStock-product.reserved}} </span>
        items
      </p>
      <div *ngIf="role$ | async as role">
      <div *ngIf="role =='ROLE_NO_AUTH_CUSTOMER' || role == 'ROLE_CUSTOMER'">
        <span class="pt-3 mb-5"> Amount </span>
        <input type="number"
               step="1"
               value="1"
               min="1"
               max="{{product.inStock}}"
               (input)="onInput($event)"
               (keydown)="onInput($event)"
        >
      </div>

      <div class="buttons">
        <button class="action edit"
                mat-raised-button color="primary"
                [disabled]="currentValue > product.inStock || currentValue < 1 || product.inStock == 0"
                *ngIf="role =='ROLE_NO_AUTH_CUSTOMER' || role == 'ROLE_CUSTOMER'"
                (click)="addToCart(product.productId)"

        >
          Add to card
        </button>

        <button class="action edit"
                mat-raised-button color="primary"
                *ngIf="role == 'ROLE_NO_AUTH_CUSTOMER' || role == 'ROLE_CUSTOMER'"
                (click)="addToCompare(product.productId)"
        >

          Compare
        </button>
      </div>

      <div class="editing">
        <button class="action edit"
                [routerLink]="['./edit']"
                *ngIf="role =='ROLE_ADMIN' || role == 'ROLE_PRODUCT_MGR'"
                mat-raised-button color="primary"
        >
          Edit
        </button>
      </div>
      </div>
      <div class="warn">
        <span class="warning" *ngIf="currentValue > product.inStock">
          Sorry now available only {{product.inStock}} items
        </span>
        <span class="warning" *ngIf="currentValue < 1">Add at least one items</span>
        <span class="warning warning-avail" *ngIf="currentValue == product.inStock">
          This is the maximum available amount
        </span>
      </div>

    </div>
  </div>
</section>
